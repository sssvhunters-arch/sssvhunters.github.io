<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Candidate Dashboard</title>

<style>

body{
margin:0;
font-family:Arial;
background:#f1f5f9;
}

header{
background:#1e3c72;
color:white;
padding:20px;
display:flex;
justify-content:space-between;
}

.container{
padding:30px;
}

.job{
background:white;
padding:20px;
margin-bottom:15px;
border-radius:10px;
box-shadow:0 5px 15px rgba(0,0,0,.1);
}

button{
padding:10px;
border:none;
background:#1e3c72;
color:white;
cursor:pointer;
}

</style>
</head>

<body>

<header>
<h2>Candidate Dashboard</h2>
<button id="logout">Logout</button>
</header>

<div class="container">

<h3>Available Jobs</h3>

<div id="jobs">Loading...</div>

</div>

<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import {
getAuth,
onAuthStateChanged,
signOut
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
getFirestore,
collection,
getDocs,
addDoc,
doc,
serverTimestamp
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* CONFIG */

const firebaseConfig={
apiKey: "AIzaSyCseBuz6XomVg_R1s3eLk0WBjvf2pGW8po",
  authDomain: "sssvhunters-jobboard.firebaseapp.com",
  projectId: "sssvhunters-jobboard",
  storageBucket: "sssvhunters-jobboard.firebasestorage.app",
  messagingSenderId: "724150870358",
  appId: "1:724150870358:web:901c334ce94d530aefb6f7",
  measurementId: "G-M1R2YQTW20"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let currentUser=null;
let tenantId="sssv_hunters";

/* AUTH PROTECTION */

onAuthStateChanged(auth,async(user)=>{

if(!user){
location.href="auth.html";
return;
}

currentUser=user;

loadJobs();

});

/* LOAD JOBS */

async function loadJobs(){

jobs.innerHTML="Loading jobs...";

const ref=
collection(
db,
"tenants",
tenantId,
"jobs"
);

const snap=await getDocs(ref);

jobs.innerHTML="";

snap.forEach(d=>{

const job=d.data();

jobs.innerHTML+=`

<div class="job">
<h3>${job.title}</h3>
<p><b>Location:</b> ${job.location}</p>
<p>${job.description}</p>

<button onclick="applyJob('${d.id}')">
Apply
</button>

</div>

`;

});

}

/* APPLY */

window.applyJob=async(jobId)=>{

await addDoc(
collection(
db,
"tenants",
tenantId,
"applications"
),
{
jobId:jobId,
candidateId:currentUser.uid,
appliedAt:serverTimestamp(),
status:"applied"
});

alert("Application Submitted âœ…");

};

/* LOGOUT */

logout.onclick=()=>{
signOut(auth);
location.href="auth.html";
};

</script>

</body>
</html>
