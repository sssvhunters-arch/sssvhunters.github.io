<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>SSSV Hunters | Secure Access</title>

<style>

body{
margin:0;
font-family:Arial;
background:url("bg.jpg") center/cover no-repeat;
height:100vh;
display:flex;
justify-content:center;
align-items:center;
}

.card{
background:rgba(255,255,255,.96);
padding:40px;
width:420px;
border-radius:12px;
box-shadow:0 10px 40px rgba(0,0,0,.35);
}

h2{text-align:center;}

.tabs{
display:flex;
margin-bottom:20px;
}

.tabs button{
flex:1;
padding:12px;
border:none;
cursor:pointer;
font-weight:bold;
}

.active{
background:#1e3c72;
color:white;
}

input{
width:100%;
padding:12px;
margin:10px 0;
border-radius:6px;
border:1px solid #ccc;
}

button.main{
width:100%;
padding:12px;
background:#1e3c72;
color:white;
border:none;
cursor:pointer;
}

.msg{
text-align:center;
margin-top:10px;
color:red;
}

.success{color:green;}

</style>
</head>

<body>

<div class="card">

<h2>SSSV Hunters</h2>

<div class="tabs">
<button id="loginTab" class="active">Login</button>
<button id="signupTab">Sign Up</button>
</div>

<input id="nameInput" placeholder="Full Name" style="display:none">
<input id="emailInput" placeholder="Email">
<input id="passwordInput" type="password" placeholder="Password">

<button class="main" id="actionBtn">
Secure Login
</button>

<p id="msg" class="msg"></p>

</div>

<script type="module">

/* ================= FIREBASE ================= */

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import {
getAuth,
createUserWithEmailAndPassword,
signInWithEmailAndPassword,
sendEmailVerification,
onAuthStateChanged,
signOut
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
getFirestore,
doc,
setDoc,
getDoc,
serverTimestamp
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


const firebaseConfig={
apiKey:"AIzaSyCseBuz6XomVg_R1s3eLk0WBjvf2pGW8po",
authDomain:"sssvhunters-jobboard.firebaseapp.com",
projectId:"sssvhunters-jobboard",
storageBucket:"sssvhunters-jobboard.appspot.com",
messagingSenderId:"724150870358",
appId:"1:724150870358:web:901c334ce94d530aefb6f7"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

/* ================= ELEMENTS ================= */

let mode="login";

const loginTab=document.getElementById("loginTab");
const signupTab=document.getElementById("signupTab");

const nameInput=document.getElementById("nameInput");
const emailInput=document.getElementById("emailInput");
const passwordInput=document.getElementById("passwordInput");

const actionBtn=document.getElementById("actionBtn");
const msg=document.getElementById("msg");

/* ================= AUTO SESSION LOGIN ================= */

onAuthStateChanged(auth, async(user)=>{

if(!user) return;

if(!user.emailVerified) return;

const snap=
await getDoc(doc(db,"users",user.uid));

if(!snap.exists()) return;

const role=snap.data().role;

if(role==="admin")
location.href="admin-dashboard.html";
else
location.href="candidate-dashboard.html";

});

/* ================= TAB SWITCH ================= */

loginTab.onclick=()=>{
mode="login";
loginTab.classList.add("active");
signupTab.classList.remove("active");

nameInput.style.display="none";
actionBtn.innerText="Secure Login";
};

signupTab.onclick=()=>{
mode="signup";
signupTab.classList.add("active");
loginTab.classList.remove("active");

nameInput.style.display="block";
actionBtn.innerText="Create Account";
};

/* ================= PASSWORD CHECK ================= */

function strongPassword(p){
return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{8,}$/.test(p);
}

/* ================= AUTH SYSTEM ================= */

actionBtn.addEventListener("click",async()=>{

msg.innerText="";

const name=nameInput.value.trim();
const email=emailInput.value.trim();
const password=passwordInput.value.trim();

try{

/* ---------- SIGNUP ---------- */

if(mode==="signup"){

if(!name){
msg.innerText="Enter name.";
return;
}

if(!strongPassword(password)){
msg.innerText="Weak password.";
return;
}

const userCred=
await createUserWithEmailAndPassword(auth,email,password);

await sendEmailVerification(userCred.user);

await setDoc(doc(db,"users",userCred.user.uid),{
name:name,
email:email,
role:"candidate",
createdAt:serverTimestamp()
});

await signOut(auth);

msg.className="msg success";
msg.innerText=
"Account created. Verify email before login.";

return;
}

/* ---------- LOGIN ---------- */

const userCred=
await signInWithEmailAndPassword(auth,email,password);

const user=userCred.user;

if(!user.emailVerified){
await signOut(auth);
msg.innerText="Verify email first.";
return;
}

const snap=
await getDoc(doc(db,"users",user.uid));

if(!snap.exists()){
msg.innerText="Access denied.";
return;
}

const role=snap.data().role;

if(role==="admin")
location.href="admin-dashboard.html";
else
location.href="candidate-dashboard.html";

}catch(e){

msg.innerText="Authentication failed.";

}

});

</script>

</body>
</html>
