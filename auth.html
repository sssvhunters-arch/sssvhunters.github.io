<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SSSV Hunters | Access</title>

<style>

body{
margin:0;
font-family:Arial;
background:url("bg.jpg") center/cover no-repeat;
height:100vh;
display:flex;
justify-content:center;
align-items:center;
}

.card{
background:#fff;
padding:35px;
width:420px;
border-radius:12px;
box-shadow:0 10px 40px rgba(0,0,0,.3);
}

.tabs{display:flex;margin-bottom:15px;}

.tabs button{
flex:1;
padding:12px;
border:none;
cursor:pointer;
font-weight:bold;
}

.active{
background:#1e3c72;
color:white;
}

input{
width:100%;
padding:12px;
margin:10px 0;
border-radius:6px;
border:1px solid #ccc;
}

button.main{
width:100%;
padding:12px;
background:#1e3c72;
color:white;
border:none;
cursor:pointer;
}

.password-box{
position:relative;
}

.show{
position:absolute;
right:10px;
top:14px;
cursor:pointer;
}

.msg{text-align:center;margin-top:10px;}
.success{color:green;}
.error{color:red;}

</style>
</head>

<body>

<div class="card">

<h2>SSSV Hunters</h2>

<div class="tabs">
<button id="loginTab" class="active">Login</button>
<button id="signupTab">Sign Up</button>
</div>

<input id="name" placeholder="Full Name" style="display:none">
<input id="email" placeholder="Email">

<div class="password-box">
<input id="password" type="password" placeholder="Password">
<span class="show" id="togglePass">üëÅ</span>
</div>

<button class="main" id="actionBtn">Secure Login</button>

<p id="msg" class="msg"></p>

</div>

<script type="module">

import {initializeApp}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import {
getAuth,
createUserWithEmailAndPassword,
signInWithEmailAndPassword
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
getFirestore,
doc,
setDoc,
getDoc,
collection,
getDocs,
serverTimestamp
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig={
  apiKey: "AIzaSyCseBuz6XomVg_R1s3eLk0WBjvf2pGW8po",
  authDomain: "sssvhunters-jobboard.firebaseapp.com",
  projectId: "sssvhunters-jobboard",
  storageBucket: "sssvhunters-jobboard.firebasestorage.app",
  messagingSenderId: "724150870358",
  appId: "1:724150870358:web:901c334ce94d530aefb6f7",
  measurementId: "G-M1R2YQTW20"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let mode="login";
let busy=false;

const msg=document.getElementById("msg");

/* PASSWORD SHOW */
togglePass.onclick=()=>{
password.type=
password.type==="password"?"text":"password";
};

/* TAB SWITCH */

loginTab.onclick=()=>{
mode="login";
loginTab.classList.add("active");
signupTab.classList.remove("active");
name.style.display="none";
actionBtn.innerText="Secure Login";
};

signupTab.onclick=()=>{
mode="signup";
signupTab.classList.add("active");
loginTab.classList.remove("active");
name.style.display="block";
actionBtn.innerText="Create Account";
};

/* SAFE CLICK */
actionBtn.onclick=async()=>{

if(busy) return;
busy=true;
actionBtn.disabled=true;

msg.innerText="Processing...";

try{

const emailVal=email.value.trim();
const passVal=password.value.trim();
const nameVal=name.value.trim();

/* SIGNUP */

if(mode==="signup"){

const cred=
await createUserWithEmailAndPassword(
auth,emailVal,passVal
);

/* CHECK FIRST USER */
const usersSnap=
await getDocs(collection(db,"users"));

let role="candidate";

if(usersSnap.empty){
role="admin";   // FIRST USER AUTO ADMIN
}

await setDoc(doc(db,"users",cred.user.uid),{
name:nameVal,
email:emailVal,
role:role,
createdAt:serverTimestamp()
});

msg.className="msg success";
msg.innerText=
role==="admin"
?"Admin account created"
:"Account created";

}

/* LOGIN */

if(mode==="login"){

const cred=
await signInWithEmailAndPassword(
auth,emailVal,passVal
);

const snap=
await getDoc(doc(db,"users",cred.user.uid));

const role=snap.data().role;

if(role==="admin")
location.href="admin-dashboard.html";
else
location.href="candidate-dashboard.html";

}

}catch(e){
msg.className="msg error";
msg.innerText=e.message;
}

busy=false;
actionBtn.disabled=false;

};

</script>

</body>
</html>
