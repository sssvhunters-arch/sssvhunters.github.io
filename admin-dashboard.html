<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>

<style>

body{
margin:0;
font-family:Arial;
background:#0f172a;
color:white;
}

header{
padding:20px;
background:#1e293b;
display:flex;
justify-content:space-between;
}

.container{
padding:30px;
}

input,textarea{
width:100%;
padding:10px;
margin:8px 0;
}

button{
padding:10px 15px;
background:#2563eb;
border:none;
color:white;
cursor:pointer;
}

.job{
background:#1e293b;
padding:15px;
margin-top:10px;
border-radius:8px;
}

</style>
</head>

<body>

<header>
<h2>Admin Panel</h2>
<button id="logout">Logout</button>
</header>

<div class="container">

<h3>Create Job</h3>

<input id="title" placeholder="Job Title">
<input id="location" placeholder="Location">
<textarea id="desc" placeholder="Description"></textarea>

<button id="postJob">Post Job</button>

<hr>

<h3>All Jobs</h3>
<div id="jobs"></div>

</div>

<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import {
getAuth,
onAuthStateChanged,
signOut
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
getFirestore,
collection,
addDoc,
getDocs,
deleteDoc,
doc,
query,
where,
serverTimestamp
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* CONFIG */
const firebaseConfig={
apiKey:"YOUR_KEY",
authDomain:"YOUR_DOMAIN",
projectId:"sssvhunters-jobboard"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let currentTenant=null;

/* AUTH PROTECTION */

onAuthStateChanged(auth,async(user)=>{

if(!user){
location.href="auth.html";
return;
}

/* LOAD TENANT */
currentTenant="sssv_hunters";

loadJobs();

});

/* CREATE JOB */

postJob.onclick=async()=>{

await addDoc(
collection(db,
"tenants",
currentTenant,
"jobs"
),
{
title:title.value,
location:location.value,
description:desc.value,
status:"active",
createdAt:serverTimestamp()
});

loadJobs();

};

/* LOAD JOBS */

async function loadJobs(){

jobs.innerHTML="Loading...";

const q =
collection(db,
"tenants",
currentTenant,
"jobs"
);

const snap=await getDocs(q);

jobs.innerHTML="";

snap.forEach(d=>{

const job=d.data();

jobs.innerHTML+=`

<div class="job">
<h4>${job.title}</h4>
<p>${job.location}</p>
<button onclick="deleteJob('${d.id}')">
Delete
</button>
</div>

`;

});

}

/* DELETE */

window.deleteJob=async(id)=>{

await deleteDoc(
doc(db,
"tenants",
currentTenant,
"jobs",
id
));

loadJobs();

};

/* LOGOUT */

logout.onclick=()=>{
signOut(auth);
location.href="auth.html";
};

</script>

</body>
</html>
